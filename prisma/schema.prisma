generator client {
  provider   = "prisma-client"
  output     = "../generated/prisma"
  engineType = "client"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String   @id @default(cuid())
  steamId64 String   @unique

  personaName String?
  avatar      String?
  visibility  Int?      
  personaState Int?     // online/offline... 
  lastLogOff Int?
  timeCreated Int?
  locCountryCode String?

  lastSyncAt DateTime?
  
  ownedGames  OwnedGame[]
  
   // Friend relations
  friendsInitiated Friend[] @relation("FriendsInitiated")
  friendsReceived  Friend[] @relation("FriendsReceived")

  createdAt DateTime @default(now())
}

model OwnedGame {
  id        String   @id @default(cuid())

  appid     Int
  name      String
  icon      String?        // Steam img_icon_url
  genre     String?        // nullable, enrich later

  playtimeForever Int      // minutes
  playtime2Weeks  Int?     // minutes
  lastPlayedAt    DateTime?

  achievementsUnlocked Int?
  achievementsTotal    Int?

  user     User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId  String

  @@unique([userId, appid])
}

model Friend {
  id String @id @default(cuid())

  user   User   @relation("FriendsInitiated", fields: [userId], references: [id], onDelete: Cascade)
  userId String

  // The friend being referenced
  friend   User   @relation("FriendsReceived", fields: [friendId], references: [id], onDelete: Cascade)
  friendId String

  since        DateTime?
  isFavorite  Boolean   @default(false)
  isHidden    Boolean   @default(false) // privacy toggle

  @@unique([userId, friendId])
  @@index([friendId])
}